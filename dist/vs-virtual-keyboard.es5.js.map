{"version":3,"file":"vs-virtual-keyboard.es5.js","sources":["../src/actions/keyboard-toggle.ts","../src/actions/keyboard-mode-shift.ts","../src/actions/keyboard-typed.ts","../src/actions/keyboard-variation-toggle.ts","../src/actions/index.ts","../src/utils/create-element.ts","../src/utils/is-touch.ts","../src/components/keyboard.ts","../src/vs-virtual-keyboard.ts"],"sourcesContent":["import KeyboardState from '../types/kb-state'\n\nexport default (state: KeyboardState, params: any) => {\n  if (!params.input) {\n    return { ...state, input: null }\n  }\n  if ((state.config?.availableInTypes || ['text']).indexOf(params.input.type || '') === -1) {\n    return { ...state, input: null }\n  }\n  return { ...state, input: params.input }\n}\n","import KeyboardKey from '../types/kb-key'\nimport KeyboardState from '../types/kb-state'\n\nfunction getLayoutTable(layoutJson: Array<Array<KeyboardKey>>) {\n  return layoutJson.map(l =>\n    l.map(symbolKey => {\n      if (typeof symbolKey === 'string') {\n        return { symbol: symbolKey }\n      }\n      if (symbolKey.variations) {\n        return {\n          ...(symbolKey as any),\n          variations: symbolKey.variations.map(subSymbol => {\n            if (typeof subSymbol === 'string') {\n              return { symbol: subSymbol }\n            }\n            return { ...(subSymbol as any) }\n          })\n        }\n      }\n      return { ...(symbolKey as any) }\n    })\n  )\n}\n\nexport default (state: KeyboardState, params: any) => {\n  state.layoutName = params.layoutName\n\n  try {\n    state.layout = getLayoutTable(\n      params.layout || state.config?.layouts?.layouts.find(l => l.name === state.layoutName)?.rows\n    )\n  } catch (err) {\n    console.error(err)\n  }\n\n  return { ...state }\n}\n","import KeyboardState from '../types/kb-state'\n\nexport default (state: KeyboardState, params: any) => {\n  return { ...state, variationShow: null }\n}\n","import KeyboardKey from '../types/kb-key'\nimport KeyboardState from '../types/kb-state'\n\nexport default (state: KeyboardState, params: any) => {\n  const key: KeyboardKey = params.key\n\n  return {\n    ...state,\n    variationShow: key\n  }\n}\n","import kdToggle from './keyboard-toggle'\nimport kdModeShift from './keyboard-mode-shift'\nimport kbTyped from './keyboard-typed'\nimport variationToggle from './keyboard-variation-toggle'\n\nexport const ACTION_KB_TOGGLE = 0\nexport const ACTION_MODE_TOGGLE = 2\nexport const ACTION_KB_TYPED = 3\nexport const ACTION_VARIATION_TOGGLE = 4\n\nconst actions: Map<Number, Function> = new Map<Number, Function>()\n\nactions.set(ACTION_KB_TOGGLE, kdToggle)\nactions.set(ACTION_MODE_TOGGLE, kdModeShift)\nactions.set(ACTION_KB_TYPED, kbTyped)\nactions.set(ACTION_VARIATION_TOGGLE, variationToggle)\n\nexport default actions\n","\nexport const h = (tagName: string, classList: string, children: Array<any>, options: any= null) => {\n  const el = document.createElement(tagName);\n  (classList || '').split(' ').forEach(cl => cl && el.classList.add(cl));\n  (children || []).forEach(c => el.appendChild(c));\n  if (!options) {\n    return el;\n  }\n\n  if (typeof options === 'string') {\n    el.textContent = options;\n    return el;\n  }\n\n  Object.keys(options).forEach(o => el.setAttribute(o, options[o]));\n\n  return el;\n}\n","\nconst isTouchDevice = () => (('ontouchstart' in window) ||\n                            (navigator.maxTouchPoints > 0) ||\n                            (navigator.msMaxTouchPoints > 0));\n\nexport default isTouchDevice;\n","import { ACTION_KB_TYPED, ACTION_MODE_TOGGLE, ACTION_VARIATION_TOGGLE } from '../actions'\nimport KeyboardConfig from '../types/kb-config'\nimport KeyboardKey from '../types/kb-key'\nimport KeyboardState from '../types/kb-state'\nimport { h } from '../utils/create-element'\nimport isTouchDevice from '../utils/is-touch'\n\n\nlet preventFocusOut = false\nlet cancelPullout = false\nlet variationsTimeout: any\nexport const getPreventFocusOut = () => preventFocusOut;\n\n\nfunction addKeyboardKeyListener(\n  buttonEl: any,\n  config: KeyboardConfig,\n  action: Function,\n  key: KeyboardKey,\n  state: KeyboardState\n) {\n  let cancelTouchEnd = false\n\n  const isTouch = isTouchDevice()\n  const eventTrigger = isTouch ? 'touchstart' : 'mousedown'\n  const eventPullout = isTouch ? 'touchend' : 'mouseup'\n\n  buttonEl.addEventListener(eventTrigger, (event: any) => {\n    cancelTouchEnd = false\n    if (!state.input) {\n      return\n    }\n    variationsTimeout && clearTimeout(variationsTimeout)\n    variationsTimeout = setTimeout(() => {\n      cancelTouchEnd = true\n      if (key.variations && key.variations.length) {\n        action(ACTION_VARIATION_TOGGLE, { key })\n        cancelPullout = true\n        setTimeout(() => cancelPullout = false, 400)\n      }\n    }, 1e3)\n  })\n\n  buttonEl.addEventListener(eventPullout, (event: any) => {\n    if (cancelPullout) {\n      return\n    }\n\n    variationsTimeout && clearTimeout(variationsTimeout)\n\n    setTimeout(() => {\n\n      if (cancelTouchEnd) {\n        return\n      }\n\n      if (!state.input) {\n        return\n      }\n\n      state.input = state.input || {}\n\n      // Keyup optional listener\n      if (config.onKeyUp) {\n        const newVal = config.onKeyUp(state.input?.value, key)\n        state.input.value = newVal || ''\n      }\n\n      // Keydown optional listener\n      if (config.onKeyDown) {\n        const newVal = config.onKeyDown(state.input?.value, key)\n        state.input.value = newVal || ''\n      }\n\n      // OnChange optional listener\n      if (config.onChange) {\n        const newVal = config.onChange(state.input?.value, key)\n        state.input.value = newVal || ''\n      }\n\n      // Key custom action\n      if (key.action) {\n        const newVal = key.action(state.input?.value)\n        state.input.value = newVal || ''\n        return\n      } else if (key.layoutShift) {\n        // Layout shift key\n        action(ACTION_MODE_TOGGLE, { layoutName: key.layoutShift })\n        return\n      } else {\n        state.input.value = state.input.value + '' + key.symbol\n      }\n\n      action(ACTION_KB_TYPED, {})\n    }, 200)\n  });\n}\n\n\nexport default (state: KeyboardState, config: KeyboardConfig, action: Function) => {\n\n  // Gets the default layout for first\n  if (!state.layout) {\n    const layouts: any = config.layouts || {}\n    const layout = layouts.layouts.find((l: any) => l.name === config.layouts?.defaultLayout)\n    action(ACTION_MODE_TOGGLE, {\n      layout: layout.rows,\n      layoutName: config.layouts?.defaultLayout\n    })\n    return h('div', 'vs-virtual-kb', [])\n  }\n\n  // Kb rows format\n  const rows = state.layout.map(l => {\n\n    // Row buttons format\n    const buttons = l.map(kButton => {\n\n      let createButton: Function\n      let subButtonsEl: Array<{ key: KeyboardKey; button: any }> = []\n\n      // Button render function\n      const buttonEl: any = (createButton = (kButton: KeyboardKey) => {\n\n        // Button with icon\n        if (kButton.base64Icon) {\n          return h('button', 'vs-virtual-kb-row-button-with-icon', [\n            h('img', 'vs-virtual-kb-row-button-with-icon-icon', [], {\n              src: kButton.base64Icon,\n              alt: kButton.symbol\n            })\n          ])\n        }\n\n        // Button variations popover\n        if (state.variationShow === kButton) {\n          return h('button', 'vs-virtual-kb-row-button', [\n            (() => {\n\n              // Creates the variation popover element\n              const variationsRow = h('div', 'vs-virtual-kb-row-button-variations', [\n                ...(kButton.variations || []).map(variation => {\n                  const button = createButton(variation)\n                  subButtonsEl.push({ key: variation, button })\n                  return button\n                })\n              ])\n\n              // Stop event propagation to the parent button\n              variationsRow.addEventListener('touchstart', e => e.stopImmediatePropagation())\n              variationsRow.addEventListener('touchend', e => e.stopImmediatePropagation())\n\n              // Popover extreme position adjust\n              setTimeout(() => {\n                const width = window.innerWidth\n                const coords = variationsRow.getBoundingClientRect()\n                if (coords.x < 300) {\n                  variationsRow.style.marginLeft = '200px'\n                  return\n                }\n                if (width - coords.x < 300) {\n                  variationsRow.style.marginLeft = '-200px'\n                  return\n                }\n              }, 200)\n\n              // Returns el\n              return variationsRow\n            })(),\n            h('span', '', [], kButton.symbol)\n          ])\n        }\n\n        return h('button', 'vs-virtual-kb-row-button', [], kButton.symbol)\n      })(kButton)\n\n      // Applies key specific class\n      let hash\n      try {\n        hash = btoa(kButton.symbol)\n      } catch (err) {\n        hash = encodeURIComponent(kButton.symbol)\n      }\n      buttonEl.classList.add(`vs-virtual-kb-key-${hash.split('=').join('')}`)\n\n      // Adding click listeners\n      addKeyboardKeyListener(buttonEl, config, action, kButton, state)\n      subButtonsEl.forEach(b => addKeyboardKeyListener(b.button, config, action, b.key, state))\n\n      return buttonEl\n    })\n\n    // Row buttons div\n    return h('div', 'vs-virtual-kb-row', buttons)\n  })\n\n  // App main div\n  const appDiv = h(\n    'div',\n    `vs-virtual-kb ${config.wrpClass || ''} vs-virtual-kb-closed${\n      state.input ? 'vs-virtual-kb-opened' : ''\n    }`,\n    rows\n  )\n\n  // No context menu\n  appDiv.addEventListener('contextmenu', e => {\n    e.preventDefault()\n    state.input.focus()\n  })\n\n  // Variation close\n  appDiv.addEventListener('click', e => {\n    if (state.variationShow) {\n      action(ACTION_VARIATION_TOGGLE, {})\n    }\n  })\n\n  // Prevent focus out notification\n  let preventFocusOutTimeout: any;\n  appDiv.addEventListener('mousedown', () => {\n    preventFocusOut = true;\n    if (preventFocusOutTimeout) {\n      clearTimeout(preventFocusOutTimeout);\n    }\n    preventFocusOutTimeout = setTimeout(() => preventFocusOut = false, 50);\n  });\n\n  return appDiv\n}\n","import actions from './actions'\nimport { ACTION_KB_TOGGLE, ACTION_MODE_TOGGLE } from './actions'\nimport keyboard, { getPreventFocusOut } from './components/keyboard'\nimport KeyboardConfig from './types/kb-config'\nimport KeyboardState from './types/kb-state'\n\nlet keyboardEl: any\nconst VsVirtualKeyboard = (options: KeyboardConfig) => {\n  const config: KeyboardConfig = { ...options }\n\n  // Initial state\n  let currentState: KeyboardState = { config }\n\n  /**\n   * Application renderer\n   */\n  const render = (state: KeyboardState) => {\n    currentState = state\n\n    /**\n     * Keyboard lifecycle\n     */\n    const newEl = keyboard(state, config, (actionId: number, params: any) => {\n      const action = actions.get(actionId)\n      if (!action) {\n        console.warn(`${actionId} NOT EXISTS`)\n        return\n      }\n      let newState: KeyboardState = action(state, params)\n      if (config.interceptor) {\n        let stateChanged = config.interceptor({ ...newState })\n        if (stateChanged.layoutName !== newState.layoutName) {\n          const action = actions.get(ACTION_MODE_TOGGLE)\n          if (action) {\n            stateChanged = action(newState, { layoutName: stateChanged.layoutName })\n          }\n        }\n        newState = stateChanged || newState\n      }\n      render(newState)\n    })\n\n    keyboardEl ? keyboardEl.replaceWith(newEl) : document.body.appendChild(newEl)\n    keyboardEl = newEl\n\n    /**\n     * Adds default click handler to the new element\n     */\n    newEl.addEventListener('click', event => {\n      event.preventDefault()\n      if (state.input) {\n        state.input.focus()\n      }\n    })\n  }\n\n  /**\n   * Focus-in and toggle keyboard\n   */\n  let focusOutTimeout: any\n  window.addEventListener('focusin', (event: any) => {\n    focusOutTimeout && clearTimeout(focusOutTimeout)\n    const action = actions.get(ACTION_KB_TOGGLE)\n    if (action) {\n      setTimeout(() => {\n        const state: KeyboardState = action(currentState, { input: event.target })\n        render(state)\n      }, 10)\n    }\n  })\n\n  /**\n   * Focus-out interceptor and hide keyboard\n   */\n  window.addEventListener('focusout', e => {\n\n    // Clicking on kb button, input focus out, returns it\n    if (getPreventFocusOut()) {\n      currentState.input.focus();\n      e.preventDefault();\n      return;\n    }\n\n    // Focus out, hide keyboard\n    focusOutTimeout = setTimeout(() => {\n      const action = actions.get(ACTION_KB_TOGGLE)\n      if (action) {\n        const state: KeyboardState = action(currentState, { input: null })\n        render(state)\n      }\n    }, 600)\n  })\n\n  // First render\n  render(currentState)\n}\n\n;(window as any).VsVirtualKeyboard = VsVirtualKeyboard\nexport default VsVirtualKeyboard\n"],"names":[],"mappings":"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"}